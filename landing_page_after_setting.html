<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My BCIT Project</title>
    <meta name="comp1800 boilerplate code" content="my bcit project">
    <meta name="author" content="BCIT">

    <!-- Bootstrap for Mobile-first, and JQuery -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link href="./styles/blah.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./styles/common.css">
    <link rel="stylesheet" href="./styles/landing_page.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Ranchers&display=swap" rel="stylesheet">
    <!-- Optional styles and scripts of your own -->
    <style>
        form.example input[type=text] {
            padding: 10px;
            font-size: 17px;
            border: 1px solid grey;
            float: left;
            width: 80%;
            background: #f1f1f1;
        }

        form.example button {
            float: left;
            width: 20%;
            padding: 10px;
            background: #2196F3;
            color: white;
            font-size: 17px;
            border: 1px solid grey;
            border-left: none;
            cursor: pointer;
        }

        form.example button:hover {
            background: #0b7dda;
        }

        form.example::after {
            content: "";
            clear: both;
            display: table;
        }

        .appname {
            text-align: center;
            background-color: #84ad52;
            margin-bottom: 20px;
        }

        .navbar {
            background-color: #84ad52;
        }

        div.dropdown-menu {
            background-color: #84ad52;
        }

        form.example {
            width: 80%;
        }

        #searchbar {
            background-color: #84ad52;
            width: 10%
        }

        .body {
            margin-bottom: 60px;
        }

        p {
            text-align: center
        }
    </style>

</head>

<body>

    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <div class="appname d-flex flex-row justify-content-center align-items-center sticky-top" style="height:10vh">
        <div class="logo d-flex align-items-center">
            <img class="logo" src="./logo_image/Dinosaur-icon.png">
        </div>
        <div class="d-flex">
            <h1>dine-o</h1>
        </div>
    </div>
    <div class="d-flex justify-content-center">
        <form class="example" action="/action_page.php">
            <input type="text" placeholder="Looking for..." name="search">
            <button id="searchbar" type="submit">Go<i class="fa fa-search"></i></button>
        </form>
    </div>


    <div class="container">
        <div class="d-flex justify-content-end">
            <div class=" button d-flex justify-content-end mt-2">
                <a href="write_a_review.html"><button class="btn text-light fs-5 yellow-800" href="#">Write a
                        review</button></a>
            </div>
        </div>
    </div>

    <div class="food_preference" style="padding-bottom: 100px;">
        <div class="restaurant mt-3 ms-5 d-flex flex-row flex-wrap justify-content-evenly">



        </div>

    </div>


    <!-- Bottom: Login, Home and Hangberger menu -->
    <nav class="navbar navbar-expand fixed-bottom">
        <div class="container-fluid">
            <div class="btn-group dropdown">
                <ul class="navbar-nav dropup">
                    <li class="nav-item dropup">
                        <a class="nav-link dropup-toggle" href="#" id="navbarDropup" role="button"
                            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="bi bi-list" style="font-size: 3rem; color: rgb(43, 35, 35);"></i>
                        </a>
                        <div class="dropdown-menu dropup" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="#"><i class="bi bi-hand-thumbs-up-fill"></i><b>
                                    RECOMMENDATIONS</b></a>
                            <a class="dropdown-item" href="#"><i class="bi bi-list-stars"></i><b> REVIEWS</b></a>
                            <a class="dropdown-item" href="user_preference_rev.html"><b><i class="bi bi-gear"></i>
                                    SETTINGS</b></a>
                        </div>
                    </li>
                </ul>
            </div>
            <button class="btn" href="#"><i class="bi bi-house-door-fill" style="font-size:3rem;"></i></button>
            <a href="login.html"><button class="btn" href="#"><i class="bi bi-person-circle"
                        style="font-size:3rem;"></i></button></a>
        </div>
    </nav>


    <!----------------------------------------------->
    <!-- JS: Boostrap, Firebase, API related    -->
    <!----------------------------------------------->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
    <script src="scripts/firebase_api.js"></script>
    <!--------------------------------------------------------------------->
    <!-- JS files: Your own JavaScript functions included here    -->
    <!--------------------------------------------------------------------->
    <script>



        function readRestaurants() {
            firebase.auth().onAuthStateChanged(function (user) {
                var user = firebase.auth().currentUser;
                var uid = user.uid;
                db.collection("users").doc(uid)
                    .get().then(function (doc) {
                        if (doc.data().food_quality) {
                            db.collection("restaurants")
                                .get()
                                .then(function (query) {
                                    query.forEach(function (doc) {
                                        if (doc.data().foodqualityscore >= doc.data().servicequalityscore) {
                                            add_restaurants(doc.id, doc.data().name, doc.data().pictures)
                                        }
                                    })
                                })

                        } else {
                            db.collection("restaurants")
                                .get()
                                .then(function (query) {
                                    query.forEach(function (doc) {
                                        if (doc.data().foodqualityscore < doc.data().servicequalityscore) {
                                            add_restaurants(doc.id, doc.data().name, doc.data().pictures)
                                        }
                                    })
                                })
                        }


                    })

            })
        }


        readRestaurants();

        function add_restaurants(id, name, pic) {
            //create a parent div
            let restaurant_name = document.createElement("div")

            //assign class to restaurant_name
            restaurant_name.className = "img_div d-flex flex-column align-items-center me-5 mb-1"

            //create an image div inside parent div  
            let img_div = document.createElement("div")
            img_div.className = "food mb-2 pe-3 pt-1"  // set a class

            let image = document.createElement("img")
            image.setAttribute("src", pic)
            let a_link = document.createElement("a")
            a_link.setAttribute("href", "restaurants_page.html?category=" + name)
            a_link.appendChild(image)
            img_div.appendChild(a_link)

            //create a div for restaurant name
            let text_div = document.createElement("div")
            let header = document.createElement("h5")
            text_div.appendChild(header)
            header.innerText = name

            //create a like button
            let like_div = document.createElement("div")

            //create a class to create hover effect in css
            like_div.className = "thumb"
            let like = document.createElement("h5")
            like.innerHTML = '<i class="far fa-thumbs-up thumbs" style="font-size:2rem"></i>'
            like_div.appendChild(like)

            //create a second like button
            let like_div2 = document.createElement("div")

            //create a class to create hover effect in css
            like_div2.className = "thumb"
            let like2 = document.createElement("h5")
            like2.innerHTML = '<i class="far fa-thumbs-up thumbs" style="font-size:2rem"></i>'
            like_div2.appendChild(like2)

            //number_p is the amount of likes for food quality
            let number_p = document.createElement("p")
            like_div.appendChild(number_p)


            let number_p2 = document.createElement("p")
            like_div2.appendChild(number_p2)


            //attache event listener to the first thumb
            addLikeListener(id, like, number_p)

            //attache event listener to the second thumb
            addLikeListener2(id, like2, number_p2)


            //append child divs to parent div
            restaurant_name.appendChild(img_div)
            restaurant_name.appendChild(text_div)
            restaurant_name.appendChild(like_div)
            restaurant_name.appendChild(like_div2)
        
            document.getElementsByClassName("restaurant")[0].appendChild(restaurant_name)
        }

        function addLikeListener(id, like, number_p) {
            firebase.auth().onAuthStateChanged(function (user) {
                like.addEventListener("click", function () {
                    console.log("like was click!")
                    db.collection("restaurants")
                        .doc(id)
                        .update({
                            foodqualityscore: firebase.firestore.FieldValue.increment(1) //increments like!
                        })

                })
            })

            db.collection("restaurants")
            .doc(id)
            .onSnapshot(function(snap){
                number_p.innerText="food quality " + snap.get("foodqualityscore")
            })
        }

        function addLikeListener2(id, like2, number_p2) {
            firebase.auth().onAuthStateChanged(function (user) {
                like2.addEventListener("click", function () {
                    console.log("like was click!")
                    db.collection("restaurants")
                        .doc(id)
                        .update({
                            servicequalityscore: firebase.firestore.FieldValue.increment(1) //increments like!
                        })

                })
            })

            db.collection("restaurants")
            .doc(id)
            .onSnapshot(function(snap){
                number_p2.innerText="service quality " + snap.get("servicequalityscore")
            })
        }


    </script>
</body>

</html>